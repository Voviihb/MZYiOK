     1                                  %include "../lib.asm"
     1                              <1> StrToInt:
     2 00000000 57                  <1> push edi
     3 00000001 B739                <1> mov bh,'9'
     4 00000003 B330                <1> mov bl,'0'
     5 00000005 56                  <1> push esi ; сохраняем адрес исходной строки
     6 00000006 803E2D              <1> cmp byte[esi], '-'
     7 00000009 7501                <1> jne .prod
     8 0000000B 46                  <1> inc esi ; пропускаем знак минус
     9 0000000C FC                  <1> .prod cld
    10 0000000D 6631FF              <1> xor di,di ; обнуляем будущее число
    11 00000010 AC                  <1> .cycle: lodsb ; загружаем символ (цифру)
    12 00000011 3C0A                <1> cmp al,10 ; если 10, то на конец
    13 00000013 741F                <1> je .Return
    14 00000015 38D8                <1> cmp al,bl ; сравниваем с кодом нуля
    15 00000017 722F                <1> jb .Error ; "ниже" – Ошибка
    16 00000019 38F8                <1> cmp al,bh ; сравниваем с кодом девяти
    17 0000001B 772B                <1> ja .Error ; "выше" – Ошибка
    18 0000001D 2C30                <1> sub al,30h ; получаем цифру из символа
    19 0000001F 6698                <1> cbw ; расширяем до слова
    20 00000021 6650                <1> push ax ; сохраняем в стеке
    21 00000023 66B80A00            <1> mov ax,10 ; заносим 10 в AX
    22 00000027 66F7E7              <1> mul di ; умножаем, результат в DX:AX
    23 0000002A 665F                <1> pop di ; в DI – очередная цифра
    24 0000002C 6601F8              <1> add ax,di
    25 0000002F 6689C7              <1> mov di,ax ; в DI – накопленное число
    26 00000032 EBDC                <1> jmp .cycle
    27 00000034 5E                  <1> .Return: pop esi
    28 00000035 BB00000000          <1> mov ebx,0
    29 0000003A 803E2D              <1> cmp byte[esi],'-'
    30 0000003D 7503                <1> jne .J
    31 0000003F 66F7DF              <1> neg di
    32 00000042 6689F8              <1> .J mov ax,di
    33 00000045 98                  <1> cwde
    34 00000046 EB0B                <1> jmp .R
    35 00000048 5E                  <1> .Error: pop esi
    36 00000049 B800000000          <1> mov eax,0
    37 0000004E BB01000000          <1> mov ebx,1
    38 00000053 5F                  <1> .R pop EDI
    39 00000054 C3                  <1> ret
    40                              <1> 
    41                              <1> 
    42                              <1> 
    43                              <1> IntToStr:
    44 00000055 57                  <1> push edi
    45 00000056 53                  <1> push ebx
    46 00000057 52                  <1> push edx
    47 00000058 51                  <1> push ecx
    48 00000059 56                  <1> push esi
    49 0000005A C60600              <1> mov byte[esi],0 ; на место знака
    50 0000005D 83F800              <1> cmp eax,0
    51 00000060 7D05                <1> jge .l1
    52 00000062 F7D8                <1> neg eax
    53 00000064 C6062D              <1> mov byte[esi],'-'
    54 00000067 C646060A            <1> .l1 mov byte[esi+6],10
    55 0000006B BF05000000          <1> mov edi,5
    56 00000070 66BB0A00            <1> mov bx,10
    57 00000074 6699                <1> .again: cwd ; расширили слово до двойного
    58 00000076 66F7F3              <1> div bx ; делим результат на 10
    59 00000079 80C230              <1> add dl,30h ; получаем из остатка код цифры
    60 0000007C 88143E              <1> mov [esi+edi],DL ; пишем символ в строку
    61 0000007F 4F                  <1> dec edi ; переводим указатель на
    62                              <1> ; предыдущую позицию
    63 00000080 6683F800            <1> cmp ax, 0 ; преобразовали все число?
    64 00000084 75EE                <1> jne .again
    65 00000086 B806000000          <1> mov eax, 6
    66 0000008B 29F9                <1> sub ecx, edi ; длина результата+знак
    67 0000008D 89C8                <1> mov eax,ecx
    68 0000008F 40                  <1> inc eax ; длина результата+знак+0А
    69 00000090 46                  <1> inc esi ; пропускаем знак
    70 00000091 56                  <1> push esi
    71 00000092 8D343E              <1> lea esi,[esi+edi] ; начало символов результата
    72 00000095 5F                  <1> pop edi
    73                              <1> ;rep movsb
    74 00000096 5E                  <1> pop esi
    75 00000097 59                  <1> pop ecx
    76 00000098 5A                  <1> pop edx
    77 00000099 5B                  <1> pop ebx
    78 0000009A 5F                  <1> pop edi
    79 0000009B C3                  <1> ret
     2                                  
     3                                  section .data ; сегмент инициализированных переменных
     4 00000000 456E74657220612C20-     enterMsg db "Enter a, x, b, y ",10
     4 00000009 782C20622C2079200A 
     5                                  lenEnterMsg equ $-enterMsg
     6                                  
     7                                  section .bss ; сегмент неинициализированных переменных
     8 00000000 <res 0000000A>          inBuf resb 10 ; буфер для вводимой строки
     9                                  lenIn equ $-inBuf
    10                                  
    11 0000000A <res 00000007>          outBuf resb 7
    12                                  lenOut equ $-outBuf
    13                                  
    14 00000011 <res 00000002>          a resw 1
    15 00000013 <res 00000002>          x resw 1
    16 00000015 <res 00000002>          b resw 1
    17 00000017 <res 00000002>          y resw 1
    18 00000019 <res 00000002>          n resw 1
    19                                  
    20                                  section .text ; сегмент кода
    21                                  global _start
    22                                  _start:
    23                                  
    24                                  ; выводим сообщение о необходимости ввода
    25 0000009C B804000000              mov eax, 4 ; системная функция 4 (write)
    26 000000A1 BB01000000              mov ebx, 1 ; дескриптор файла stdout=1
    27 000000A6 B9[00000000]            mov ecx, enterMsg ; адрес выводимой строки
    28 000000AB BA12000000              mov edx, lenEnterMsg ; длина выводимой строки
    29 000000B0 CD80                    int 80h ; вызов системной функции
    30                                  
    31                                  
    32                                  
    33                                  ; вводим значение a
    34 000000B2 B803000000              mov eax, 3 ; системная функция 3 (read)
    35 000000B7 BB00000000              mov ebx, 0 ; дескриптор файла stdin=0
    36 000000BC B9[00000000]            mov ecx, inBuf ; адрес буфера ввода
    37 000000C1 BA0A000000              mov edx, lenIn ; размер буфера
    38 000000C6 CD80                    int 80h ; вызов системной функции
    39                                  
    40                                  ; передаем значние в функцию
    41 000000C8 BE[00000000]            mov esi,inBuf ; адрес введенной строки
    42 000000CD E82EFFFFFF              call StrToInt
    43 000000D2 83FB00                  cmp EBX, 0 ; проверка кода ошибки
    44 000000D5 66A3[11000000]          mov [a], ax ; запись числа в память
    45                                  
    46                                  
    47                                  ; вводим значение x
    48 000000DB B803000000              mov eax, 3 ; системная функция 3 (read)
    49 000000E0 BB00000000              mov ebx, 0 ; дескриптор файла stdin=0
    50 000000E5 B9[00000000]            mov ecx, inBuf ; адрес буфера ввода
    51 000000EA BA0A000000              mov edx, lenIn ; размер буфера
    52 000000EF CD80                    int 80h ; вызов системной функции
    53                                  
    54                                  ; передаем значние в функцию
    55 000000F1 BE[00000000]            mov esi,inBuf ; адрес введенной строки
    56 000000F6 E805FFFFFF              call StrToInt
    57 000000FB 83FB00                  cmp EBX, 0 ; проверка кода ошибки
    58 000000FE 66A3[13000000]          mov [x], ax ; запись числа в память
    59                                  
    60                                  
    61                                  ; вводим значение b
    62 00000104 B803000000              mov eax, 3 ; системная функция 3 (read)
    63 00000109 BB00000000              mov ebx, 0 ; дескриптор файла stdin=0
    64 0000010E B9[00000000]            mov ecx, inBuf ; адрес буфера ввода
    65 00000113 BA0A000000              mov edx, lenIn ; размер буфера
    66 00000118 CD80                    int 80h ; вызов системной функции
    67                                  
    68                                  ; передаем значние в функцию
    69 0000011A BE[00000000]            mov esi,inBuf ; адрес введенной строки
    70 0000011F E8DCFEFFFF              call StrToInt
    71 00000124 83FB00                  cmp EBX, 0 ; проверка кода ошибки
    72 00000127 66A3[15000000]          mov [b], ax ; запись числа в память
    73                                  
    74                                  
    75                                  ; вводим значение y
    76 0000012D B803000000              mov eax, 3 ; системная функция 3 (read)
    77 00000132 BB00000000              mov ebx, 0 ; дескриптор файла stdin=0
    78 00000137 B9[00000000]            mov ecx, inBuf ; адрес буфера ввода
    79 0000013C BA0A000000              mov edx, lenIn ; размер буфера
    80 00000141 CD80                    int 80h ; вызов системной функции
    81                                  
    82                                  ; передаем значние в функцию
    83 00000143 BE[00000000]            mov esi,inBuf ; адрес введенной строки
    84 00000148 E8B3FEFFFF              call StrToInt
    85 0000014D 83FB00                  cmp EBX, 0 ; проверка кода ошибки
    86 00000150 66A3[17000000]          mov [y], ax ; запись числа в память
    87                                  
    88                                  
    89                                  ; начинаем вычисления
    90 00000156 668B0D[17000000]        mov CX, [y]
    91 0000015D 66030D[11000000]        add CX, [a] ;CX = y + a
    92 00000164 66A1[13000000]          mov AX, [x]
    93 0000016A 6699                    cwd ;AX -> DX:AX (расширение для деления)
    94 0000016C 66F7F9                  idiv CX ; AX := (DX:AX) / CX или x / (y + a)
    95 0000016F 6689C6                  mov SI, AX ; сохранили результат вычисления в SI
    96                                  
    97 00000172 66A1[15000000]          mov AX, [b]
    98 00000178 66F72D[17000000]        imul WORD[y] ; DX:AX = b * y
    99 0000017F 66F73D[11000000]        idiv WORD[a] ; AX := (DX:AX) / [a] или (b * y) / a
   100 00000186 6689C7                  mov DI, AX ; сохранили результат вычисления в DI
   101                                  
   102 00000189 66A1[13000000]          mov AX, [x]
   103 0000018F 66F72D[13000000]        imul WORD[x] ; DX:AX = x * x
   104 00000196 66F72D[11000000]        imul WORD[a] ; DX:AX = a * x * x
   105                                  
   106                                  ; вычисляем результат, он будет в AX
   107 0000019D 6629F8                  sub AX, DI
   108 000001A0 6601F0                  add AX, SI
   109                                  
   110                                  
   111                                  ; выводим число из AX в консоль
   112 000001A3 98                      cwde ; развертование ax до eax
   113 000001A4 BE[0A000000]            mov ESI, outBuf
   114 000001A9 E8A7FEFFFF              call IntToStr
   115 000001AE B804000000              mov eax, 4 ; системная функция 4 (write)
   116 000001B3 BB01000000              mov ebx, 1 ; дескриптор файла stdout=1
   117 000001B8 B9[0A000000]            mov ecx, outBuf ; адрес выводимой строки
   118 000001BD BA07000000              mov edx, lenOut ; длина выводимой строки
   119 000001C2 CD80                    int 80h ; вызов системной функции
   120                                  
   121                                  
   122                                  
   123                                  ; exit
   124 000001C4 B801000000              mov eax, 1 ; системная функция 1 (exit)
   125 000001C9 31DB                    xor ebx, ebx ; код возврата 0
   126 000001CB CD80                    int 80h ; вызов системной функции
